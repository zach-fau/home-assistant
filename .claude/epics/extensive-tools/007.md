---
name: Spotify Music Control
status: open
created: 2025-10-30T22:18:30Z
updated: 2025-10-30T22:18:30Z
github: null
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task 007: Spotify Music Control

**Effort**: 6 hours (S)
**Dependencies**: [001] (needs config system)
**Parallel**: true (independent lifestyle feature)
**Conflicts**: None

## Description

Implement Spotify Web API integration with OAuth for voice-controlled music playback, search, and playlist management.

## Acceptance Criteria

- [ ] `functions/spotify_auth.py` with OAuth 2.0 setup
- [ ] `functions/spotify.py` with playback control handlers
- [ ] Playback control: play, pause, skip, previous, volume
- [ ] Music search: song, artist, album, playlist, genre
- [ ] Playlist management: add to playlist, create playlist
- [ ] Device control: select playback device
- [ ] Query current track information
- [ ] Function schemas for all Spotify functions
- [ ] All functions registered in `functions/__init__.py`
- [ ] Voice commands working: "Play some focus music", "Skip this song", "What's playing?"

## Files Created/Modified

- `functions/spotify_auth.py` (new)
- `functions/spotify.py` (new)
- `functions/__init__.py` (register functions)
- Add `spotipy` to `requirements.txt`
- `.env` (add SPOTIFY_CLIENT_ID, SPOTIFY_CLIENT_SECRET)

## Implementation Notes

### OAuth Flow
- Use Spotipy library for simplified OAuth 2.0 implementation
- Support authorization code flow with PKCE for security
- Store access tokens securely with automatic refresh
- Handle token expiration gracefully

### Playback Control Functions
- `spotify_play()` - Resume playback or play specific track/playlist/album
- `spotify_pause()` - Pause current playback
- `spotify_skip()` - Skip to next track
- `spotify_previous()` - Go to previous track
- `spotify_volume()` - Set volume (0-100)
- `spotify_shuffle()` - Toggle shuffle mode
- `spotify_repeat()` - Set repeat mode (track/context/off)

### Search Functions
- `spotify_search()` - Search for tracks, albums, artists, playlists
- Support natural language queries
- Return top results with confidence scoring

### Playlist Management
- `spotify_add_to_playlist()` - Add current/specified track to playlist
- `spotify_create_playlist()` - Create new playlist
- `spotify_get_playlists()` - List user's playlists

### Device Control
- `spotify_get_devices()` - List available playback devices
- `spotify_transfer_playback()` - Switch playback to different device

### Current Playback Info
- `spotify_now_playing()` - Get current track info (title, artist, album)
- `spotify_playback_status()` - Get full playback state

## Testing

Voice command examples to test:
- "Play some focus music"
- "Skip this song"
- "What's playing?"
- "Turn up the volume"
- "Play Bohemian Rhapsody by Queen"
- "Add this to my workout playlist"
- "Shuffle my Discover Weekly"
