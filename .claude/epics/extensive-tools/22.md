---
name: Configuration System + Weather Integration
status: open
created: 2025-10-30T22:18:30Z
updated: 2025-10-30T22:18:30Z
github: null
depends_on: []
parallel: false
conflicts_with: []
---

# Task 001: Configuration System + Weather Integration

## Overview

Implement YAML configuration system and OpenWeatherMap integration. Create `config/briefing_config.yaml` structure, add PyYAML loading logic, and implement `functions/weather.py` with current conditions, forecasts, and smart recommendations.

**Effort**: 6 hours (S)
**Dependencies**: None (foundational)
**Parallel**: false (other tasks depend on config system)

## Description

This task establishes the configuration foundation for the entire extensive-tools epic by implementing a YAML-based configuration system. It also delivers the first high-impact integration: weather information with smart recommendations.

The configuration system will support all future integrations and the morning briefing orchestration layer. The weather integration demonstrates the pattern that other integrations will follow.

## Acceptance Criteria

- [ ] `config/briefing_config.yaml` structure created with all component sections
- [ ] PyYAML loading in configuration module
- [ ] `functions/weather.py` with OpenWeatherMap API integration
- [ ] Weather handlers: current conditions, hourly forecast, daily forecast, alerts
- [ ] Smart recommendations (umbrella, outdoor activity suggestions)
- [ ] Function schemas for weather functions
- [ ] Weather registered in `functions/__init__.py`
- [ ] Voice commands working: "What's the weather?", "Do I need an umbrella?"
- [ ] Configuration loads successfully from YAML

## Files Created/Modified

**New Files**:
- `config/briefing_config.yaml` - YAML configuration with morning briefing settings and component flags
- `functions/weather.py` - OpenWeatherMap integration with handlers and schemas
- `config/__init__.py` - Configuration loading module (if needed)

**Modified Files**:
- `functions/__init__.py` - Register weather functions
- `requirements.txt` - Add `pyyaml` dependency

## Technical Details

### Configuration Structure

```yaml
morning_briefing:
  enabled: true
  scheduled_time: "07:00"
  timezone: "America/Los_Angeles"

  components:
    weather: { enabled: true, location: "Seattle, WA" }
    calendar: { enabled: true, max_events: 5 }
    email: { enabled: true, max_emails: 3 }
    tasks: { enabled: true, max_tasks: 5 }
    news:
      enabled: true
      sources:
        - { name: "ap", sections: ["politics", "tech"], max_articles: 2 }
        - { name: "nyt", sections: ["business"], max_articles: 1 }
    packages: { enabled: true }
    finance: { enabled: false }  # Opt-in only
    fitness: { enabled: false }
```

### Weather Functions

Implement these function handlers in `functions/weather.py`:

1. `get_current_weather(location: str)` - Current conditions
2. `get_hourly_forecast(location: str, hours: int = 12)` - Hourly forecast
3. `get_daily_forecast(location: str, days: int = 7)` - Daily forecast
4. `get_weather_alerts(location: str)` - Severe weather alerts
5. `get_weather_recommendation(location: str, activity: str)` - Smart recommendations

### Smart Recommendations

Based on weather conditions, provide recommendations for:
- Umbrella needed (precipitation probability > 30%)
- Outdoor activity suitability
- Clothing suggestions
- Air quality alerts

## Dependencies

**External**:
- OpenWeatherMap API (free tier, requires API key in `.env`)
- PyYAML library

**Internal**:
- Existing LLM and TTS infrastructure
- Function calling framework

## Testing Checklist

- [ ] Configuration loads without errors
- [ ] All YAML sections parse correctly
- [ ] Weather API calls succeed with valid API key
- [ ] Weather functions return properly formatted data
- [ ] Function schemas validate correctly
- [ ] Voice commands trigger weather functions
- [ ] Error handling for invalid locations
- [ ] Error handling for API failures
- [ ] Smart recommendations work correctly

## Notes

- This task is foundational - Tasks 002 and 003 depend on the config system
- Use existing patterns from `google_tasks.py` for function registration
- Store OpenWeatherMap API key in `.env` file (not in YAML)
- Implement caching for weather data (30-minute TTL) to respect rate limits
- Follow existing error handling patterns from other integrations
