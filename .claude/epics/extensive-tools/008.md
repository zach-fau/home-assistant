---
name: Package Tracking (AfterShip)
status: open
created: 2025-10-30T22:18:30Z
updated: 2025-10-30T22:18:30Z
github: null
depends_on: [001, 005]
parallel: true
conflicts_with: []
---

# Task 008: Package Tracking (AfterShip)

**Effort**: 6 hours (S)
**Dependencies**: [001, 005] (needs config + briefing for integration)
**Parallel**: true (independent feature)
**Conflicts**: None

## Description

Implement package tracking via AfterShip API with JSON file persistence and morning briefing integration.

## Acceptance Criteria

- [ ] `functions/package_tracking.py` with AfterShip API integration
- [ ] Add package by tracking number
- [ ] Auto-detect carrier (USPS, UPS, FedEx, Amazon, etc.)
- [ ] Query delivery status and estimated arrival
- [ ] JSON file persistence for active packages (`data/packages.json`)
- [ ] Mark package as received
- [ ] Integration with morning briefing (show packages arriving today)
- [ ] Function schemas for package tracking functions
- [ ] All functions registered in `functions/__init__.py`
- [ ] Voice commands working: "Where's my package?", "Do I have any deliveries today?"

## Files Created/Modified

- `functions/package_tracking.py` (new)
- `data/packages.json` (new - created on first use)
- `functions/briefing/manager.py` (add package fetching)
- `functions/__init__.py` (register functions)
- `.env` (add AFTERSHIP_API_KEY)

## Implementation Notes

### Package Data Structure
```json
{
  "packages": [
    {
      "tracking_number": "1Z999AA10123456784",
      "carrier": "ups",
      "description": "New headphones",
      "status": "in_transit",
      "estimated_delivery": "2025-10-31",
      "last_checkpoint": "Out for delivery",
      "added_date": "2025-10-28",
      "delivered": false
    }
  ]
}
```

### Core Functions

#### Package Management
- `add_package(tracking_number, description=None)` - Add new package to track
  - Auto-detect carrier via AfterShip
  - Store in `data/packages.json`
  - Return confirmation with carrier and estimated delivery

- `get_package_status(tracking_number=None)` - Query status
  - If no tracking number provided, return all active packages
  - Return status, location, estimated delivery

- `mark_delivered(tracking_number)` - Mark package as received
  - Update JSON file
  - Archive or remove from active tracking

- `list_packages()` - List all tracked packages
  - Show tracking number, description, status, ETA
  - Filter out delivered packages by default

### AfterShip API Integration

- Use AfterShip REST API v4
- Automatic carrier detection (supports 1000+ carriers)
- Webhook support for real-time updates (optional Phase 5 enhancement)

### Morning Briefing Integration

Add to `functions/briefing/manager.py`:
```python
def get_packages_today():
    """Get packages arriving today for morning briefing"""
    # Load packages.json
    # Filter by estimated_delivery == today
    # Return formatted summary
```

Briefing output example:
"You have 2 packages arriving today: your new headphones from Amazon and a book shipment from USPS."

### Error Handling

- Handle invalid tracking numbers gracefully
- Handle carrier detection failures (ask user to specify carrier)
- Handle API rate limits
- Handle missing data/packages.json (create on first use)

## Testing

Voice command examples to test:
- "Track package 1Z999AA10123456784"
- "Where's my package?"
- "Do I have any deliveries today?"
- "What packages am I expecting?"
- "Mark package 1Z999AA10123456784 as delivered"

## Future Enhancements (Phase 5)

- Webhook integration for real-time updates
- Push notifications when package status changes
- Auto-archive delivered packages after 7 days
- Multiple package nicknames (e.g., "Where's my laptop?")
