---
name: Plaid Finance Integration
status: open
created: 2025-10-30T22:18:30Z
updated: 2025-10-30T22:18:30Z
github: null
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task 009: Plaid Finance Integration

**Effort**: 8 hours (M)
**Dependencies**: [001] (needs config system)
**Parallel**: true (independent feature, can run with others)
**Conflicts**: None

## Description

Implement Plaid Link for secure bank authentication and read-only account balance queries with privacy controls.

## Acceptance Criteria

- [ ] `functions/plaid_auth.py` with Plaid Link setup
- [ ] `functions/plaid_finance.py` with account balance handlers
- [ ] Connect bank accounts via Plaid Link (secure OAuth)
- [ ] Query account balances (checking, savings, credit cards)
- [ ] List recent transactions (last N or past X days)
- [ ] Privacy controls: confirmation before speaking financial info aloud
- [ ] Support multiple banks/accounts
- [ ] Handle Plaid token expiration gracefully
- [ ] Function schemas for finance functions
- [ ] All functions registered in `functions/__init__.py`
- [ ] Voice commands working: "What's my checking account balance?"

## Files Created/Modified

- `functions/plaid_auth.py` (new)
- `functions/plaid_finance.py` (new)
- `functions/__init__.py` (register functions)
- Add `plaid-python` to `requirements.txt`
- `.env` (add PLAID_CLIENT_ID, PLAID_SECRET, PLAID_ENV)

## Implementation Notes

### Security & Privacy Requirements

**CRITICAL**: Financial data requires strict security measures:

1. **Read-Only Access**: Use Plaid's `transactions` product (read-only)
2. **No Storage**: Never store account balances or transaction details
3. **Token Security**: Store access tokens encrypted
4. **Privacy Controls**: Require confirmation before speaking amounts aloud
5. **Environment**: Use Plaid Sandbox for development, Production for deployment

### Plaid Link Setup (`plaid_auth.py`)

```python
def create_link_token():
    """Generate Plaid Link token for account connection"""
    # Create link token for frontend/voice auth flow
    # Return link token for user authentication

def exchange_public_token(public_token):
    """Exchange public token for access token after auth"""
    # Store access token securely
    # Return success confirmation

def get_access_token():
    """Retrieve stored access token"""
    # Load from secure storage
    # Check expiration and refresh if needed
```

### Core Finance Functions (`plaid_finance.py`)

#### Account Queries
- `get_accounts()` - List all connected accounts
  - Return account names, types, and masked numbers
  - Example: "Chase Checking (...1234), Savings (...5678)"

- `get_balance(account_name=None)` - Get account balance
  - If no account specified, return all balances
  - Privacy control: ask "Should I say the amount aloud?"
  - Return available balance and current balance

- `get_total_balance()` - Sum all account balances
  - Useful for net worth queries
  - Privacy control applies

#### Transaction Queries
- `get_recent_transactions(days=7, account=None)` - List recent transactions
  - Default: last 7 days, all accounts
  - Return date, merchant, amount, category
  - Privacy control: confirm before speaking details

- `search_transactions(merchant=None, category=None, min_amount=None)` - Search transactions
  - Flexible filtering by merchant name, category, or amount
  - Example: "Show me all my Amazon purchases"

### Privacy Control Implementation

Before speaking financial information:
```python
def confirm_privacy(context):
    """Check if it's safe to speak financial info aloud"""
    # Option 1: Ask user "Should I say this aloud or send it to your phone?"
    # Option 2: Check config for always_private flag
    # Option 3: Check time/location context (e.g., don't speak at work)
    return user_confirms()
```

### Token Management

- Store access tokens in `data/plaid_tokens.json` (encrypted)
- Implement automatic token refresh
- Handle token expiration gracefully (prompt re-authentication)
- Support multiple bank connections

### Error Handling

- Handle Plaid API errors (rate limits, maintenance)
- Handle invalid account names
- Handle missing/expired tokens (prompt re-auth)
- Handle network failures gracefully

### Multi-Bank Support

Support connecting multiple banks:
```json
{
  "banks": [
    {
      "institution_id": "ins_3",
      "institution_name": "Chase",
      "access_token": "access-sandbox-xxx",
      "item_id": "item-xxx",
      "accounts": [
        {"id": "acc1", "name": "Checking", "mask": "1234"},
        {"id": "acc2", "name": "Savings", "mask": "5678"}
      ]
    },
    {
      "institution_id": "ins_4",
      "institution_name": "Bank of America",
      "access_token": "access-sandbox-yyy",
      "item_id": "item-yyy",
      "accounts": [...]
    }
  ]
}
```

## Testing

Voice command examples to test:
- "What's my checking account balance?"
- "How much money do I have total?"
- "Show me my recent transactions"
- "What did I spend at Amazon this week?"
- "Connect my bank account" (initiates Plaid Link flow)

## Plaid Environment Setup

1. **Development**: Use Plaid Sandbox
   - No real bank credentials needed
   - Test with fake accounts
   - `.env`: `PLAID_ENV=sandbox`

2. **Production**: Use Plaid Development/Production
   - Requires Plaid account verification
   - Real bank connections
   - `.env`: `PLAID_ENV=production`

## Compliance Notes

- This implementation is for personal use only
- Plaid handles PCI/banking compliance
- No financial data is stored locally (only access tokens)
- Users retain full control over connected accounts
