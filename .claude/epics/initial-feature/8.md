---
name: Web Search Tool Integration
status: open
created: 2025-10-28T20:51:52Z
updated: 2025-10-28T21:06:48Z
github: https://github.com/zach-fau/home-assistant/issues/8
depends_on: [6]
parallel: true
conflicts_with: []
---

# Task: Web Search Tool Integration

## Description
Implement web search capability using Brave Search or SerpAPI to enable real-time information retrieval. The tool should search the web, summarize results intelligently, and return concise answers to user queries about current events, weather, general knowledge, and more.

## Acceptance Criteria
- [ ] Web search API integration (Brave Search or SerpAPI) working
- [ ] Search function registered with tool framework
- [ ] Results are summarized and returned in conversational format
- [ ] Caching implemented for repeated queries (optional but recommended)
- [ ] Rate limiting to control API costs
- [ ] Error handling for API failures or no results found
- [ ] Natural language queries map to effective search queries
- [ ] Results include source attribution when appropriate

## Technical Details
**Search Tool Function:**
```python
class WebSearchTool(Tool):
    name = "web_search"
    description = "Search the web for current information, news, weather, or facts"
    parameters = {
        "type": "object",
        "properties": {
            "query": {
                "type": "string",
                "description": "The search query"
            },
            "num_results": {
                "type": "integer",
                "description": "Number of results to consider (default 3)",
                "default": 3
            }
        },
        "required": ["query"]
    }

    async def execute(self, query: str, num_results: int = 3) -> dict:
        # Perform search, summarize results, return formatted response
        pass
```

**API Options (Choose One):**
1. **Brave Search API**
   - Good free tier
   - Clean API, good results
   - Simple JSON responses

2. **SerpAPI**
   - Google search results
   - More expensive but comprehensive
   - Rich structured data

**Implementation Approach:**
1. Create async client for chosen search API
2. Implement search query execution with proper error handling
3. Parse results and extract key information
4. Summarize results into concise text (may use LLM for summarization)
5. Implement simple caching (dict with TTL) for repeated queries
6. Add rate limiting to prevent cost overruns
7. Register search function with tool framework

**Result Processing:**
- Extract titles, snippets, and URLs from search results
- Combine top 3-5 results into coherent summary
- Optionally use GPT-4o-mini to synthesize information
- Include source attribution ("According to [source]...")
- Handle no results gracefully

**Configuration:**
```yaml
web_search:
  provider: "brave"  # or "serpapi"
  api_key: "${SEARCH_API_KEY}"
  max_results: 5
  cache_ttl_seconds: 300
  rate_limit_per_minute: 10
```

**Example Interactions:**
- "What's the weather tomorrow?" → search("weather forecast [user_location] tomorrow")
- "Who won the game last night?" → search("game results last night")
- "What is the capital of Mongolia?" → search("capital of Mongolia")

## Dependencies
- [ ] Task 003 (Function Calling Framework) completed
- [ ] Search API key obtained (Brave Search or SerpAPI)
- [ ] Search API key configured in .env

## Effort Estimate
- Size: M
- Hours: 6-10 hours
- Parallel: true (can be developed alongside other tools)

## Definition of Done
- [ ] Search API successfully returns results for test queries
- [ ] Results are summarized into conversational responses
- [ ] Caching reduces redundant API calls for same queries
- [ ] Rate limiting prevents excessive API usage
- [ ] Error handling for no results, API errors, network issues
- [ ] Natural language queries work for common information needs
- [ ] Response time < 3 seconds for typical searches
- [ ] Unit tests for search execution and result processing
- [ ] Integration test: Ask about current events and get accurate info
- [ ] Documentation includes API key setup instructions
